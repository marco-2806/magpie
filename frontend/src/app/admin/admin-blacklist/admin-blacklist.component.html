<div class="admin-blacklist-page text-gray-200">
  <form [formGroup]="form" class="settings-panel bg-neutral-900 border border-neutral-800 rounded-2xl p-6 shadow-lg">
    <header class="panel-header flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h2 class="text-xl font-semibold text-white mb-1">Blacklist Sources</h2>
        <p class="text-sm text-gray-400 max-w-3xl">
          Control which external blocklists are ingested and how often they are refreshed. New sources trigger an immediate sweep so
          blacklisted IPs are removed from every account.
        </p>
      </div>
    </header>

    <div class="panel-body mt-6">
      <div class="tab-stack">
        <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
          <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <h3 class="section-title">Refresh Cadence</h3>
              <p class="section-hint">Set the schedule used to download blacklist sources and purge matching proxies.</p>
            </div>
          </div>

          <div class="timer-grid mt-4" formGroupName="blacklist_timer">
            <div class="timer-field">
              <label class="field-label">Days</label>
              <p-select
                [options]="daysList"
                formControlName="days"
                optionLabel="label"
                optionValue="value"
                class="w-full">
              </p-select>
            </div>
            <div class="timer-field">
              <label class="field-label">Hours</label>
              <p-select
                [options]="hoursList"
                formControlName="hours"
                optionLabel="label"
                optionValue="value"
                class="w-full">
              </p-select>
            </div>
            <div class="timer-field">
              <label class="field-label">Minutes</label>
              <p-select
                [options]="minutesList"
                formControlName="minutes"
                optionLabel="label"
                optionValue="value"
                class="w-full">
              </p-select>
            </div>
            <div class="timer-field">
              <label class="field-label">Seconds</label>
              <p-select
                [options]="secondsList"
                formControlName="seconds"
                optionLabel="label"
                optionValue="value"
                class="w-full">
              </p-select>
            </div>
          </div>
        </section>

        <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
          <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <h3 class="section-title">Blacklist Sources</h3>
              <p class="section-hint">
                Add URLs that return IP lists. Each save instantly scrapes new entries and removes any matching proxies from every user.
              </p>
            </div>
          </div>

          <div class="mt-4" formArrayName="blacklist_sources">
            <div class="source-list flex flex-col gap-4">
              @for (source of sources.controls; track source; let i = $index) {
                <div class="source-row flex items-start gap-3" [attr.data-index]="i">
                  <div class="field-group flex-1">
                    <label class="field-label" for="blacklist-source-{{i}}">Source URL</label>
                    <input
                      id="blacklist-source-{{i}}"
                      type="url"
                      [formControlName]="i"
                      pInputText
                      class="p-inputtext-sm w-full"
                      placeholder="https://example.com/drop.txt"/>
                  </div>
                  @if (sources.length > 1) {
                    <button
                      type="button"
                      class="icon-button remove mt-6"
                      (click)="removeSource(i)">
                      <i class="pi pi-trash"></i>
                    </button>
                  }
                </div>
              }
            </div>
            <div class="mt-3">
              <button type="button" class="chip-button" (click)="addSource()">
                <i class="pi pi-plus"></i>
                <span>Add Source</span>
              </button>
            </div>
            <small class="hint-text block mt-2">Accepted sources return plain text with IPv4 entries. Duplicates are ignored automatically.</small>
          </div>
        </section>

        <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
          <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <h3 class="section-title">Website Blacklist</h3>
              <p class="section-hint">
                Domains listed here are never contacted&mdash;they cannot be used as judges, scrape sources, or blacklist feeds.
              </p>
            </div>
          </div>

          <div class="mt-4" formArrayName="website_blacklist">
            <div class="source-list flex flex-col gap-4">
              @for (site of blockedSites.controls; track site; let i = $index) {
                <div class="source-row flex items-start gap-3" [attr.data-index]="i">
                  <div class="field-group flex-1">
                    <label class="field-label" for="blocked-site-{{i}}">Website</label>
                    <input
                      id="blocked-site-{{i}}"
                      type="text"
                      [formControlName]="i"
                      pInputText
                      class="p-inputtext-sm w-full"
                      placeholder="example.com or https://example.com"/>
                  </div>
                  @if (blockedSites.length > 1) {
                    <button
                      type="button"
                      class="icon-button remove mt-6"
                      (click)="removeBlockedSite(i)">
                      <i class="pi pi-trash"></i>
                    </button>
                  }
                </div>
              }
            </div>
            <div class="mt-3">
              <button type="button" class="chip-button" (click)="addBlockedSite()">
                <i class="pi pi-plus"></i>
                <span>Add Website</span>
              </button>
            </div>
            <small class="hint-text block mt-2">Entries are matched by hostname (including subdomains) and take effect immediately.</small>
          </div>
        </section>
      </div>
    </div>

    <footer class="panel-footer mt-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <p class="text-xs text-gray-500 max-w-xl">
        Saving updates the cadence and immediately scrapes newly added sources to keep blacklisted IPs out of every account.
      </p>
      <p-button
        type="button"
        label="Save Settings"
        icon="pi pi-save"
        (onClick)="onSubmit()"
        [disabled]="!form.dirty"
        styleClass="save-button">
      </p-button>
    </footer>
  </form>
</div>
