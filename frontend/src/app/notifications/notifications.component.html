<div class="max-w-5xl mx-auto px-6 py-8 space-y-6">
  <div class="flex flex-wrap items-start justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Updates</p>
      <h1 class="text-2xl font-semibold text-slate-50">Release notes</h1>
      <p class="text-slate-400 mt-1">See what changed since your last visit and browse the full history.</p>
    </div>
    <div class="rounded-xl border border-slate-800 bg-slate-900/60 px-4 py-3 text-sm text-slate-200 min-w-[240px] shadow-lg">
      <div class="flex items-center justify-between gap-2">
        <span class="text-slate-400">Backend build</span>
        <span class="font-mono text-primary-300">{{ backendBuild()?.buildVersion || 'dev' }}</span>
      </div>
      <button
        type="button"
        class="mt-3 inline-flex items-center justify-center rounded-lg bg-sky-500 px-3 py-2 text-sm font-semibold text-white transition hover:bg-sky-400 disabled:opacity-40"
        [disabled]="!newReleases().length"
        (click)="markAllSeen()">
        Mark all as seen
      </button>
    </div>
  </div>

  @if (status().loading) {
    <div class="flex justify-center py-10">
      <app-loading></app-loading>
    </div>
  } @else if (status().error) {
    <div class="rounded-xl border border-red-500/40 bg-red-900/20 px-4 py-3 text-red-100">
      <div class="flex items-center justify-between gap-3">
        <div>
          <p class="font-semibold">Could not load updates</p>
          <p class="text-sm text-red-200/80">{{ status().error }}</p>
        </div>
        <button
          type="button"
          class="rounded-lg bg-white/10 px-3 py-2 text-sm font-semibold text-white hover:bg-white/20"
          (click)="retry()">
          Retry
        </button>
      </div>
    </div>
  } @else {
    <section class="rounded-2xl border border-slate-800 bg-slate-900/50 shadow-xl">
      <div class="flex flex-wrap items-center justify-between gap-3 border-b border-slate-800 px-5 py-4">
        <div>
          <p class="text-sm font-semibold text-slate-100">New since your last visit</p>
          <p class="text-slate-400 text-sm">
            Last seen: {{ lastSeenTag() || 'never' }} Â· Latest: {{ latestTag() || 'n/a' }}
          </p>
        </div>
        <button
          type="button"
          class="rounded-lg border border-slate-700 px-3 py-2 text-sm font-semibold text-slate-100 hover:bg-slate-800"
          [disabled]="!newReleases().length"
          (click)="markAllSeen()">
          Mark as seen
        </button>
      </div>

      @if (!newReleases().length) {
        <div class="px-5 py-6 text-slate-400">
          You're up to date. We'll highlight the next release here.
        </div>
      } @else {
        <div class="divide-y divide-slate-800">
          @for (release of newReleases(); track trackRelease) {
            <article class="px-5 py-5">
              <div class="flex flex-wrap items-start justify-between gap-3">
                <div class="space-y-1">
                  <div class="flex items-center gap-3">
                    <span class="text-sm font-semibold text-primary-300">{{ release.tagName }}</span>
                    @if (release.prerelease) {
                      <span class="rounded-full bg-amber-500/20 px-2 py-0.5 text-xs font-semibold text-amber-200">Prerelease</span>
                    }
                  </div>
                  <h3 class="text-lg font-semibold text-slate-50">
                    {{ release.title || 'Untitled release' }}
                  </h3>
                  <p class="text-sm text-slate-400">
                    Published {{ release.publishedAt | date:'medium' }}
                  </p>
                </div>
                <a
                  class="text-sm font-semibold text-sky-300 hover:text-sky-200"
                  [href]="release.htmlUrl"
                  target="_blank"
                  rel="noopener noreferrer">
                  View on GitHub
                </a>
              </div>
              <pre class="mt-3 max-h-64 overflow-y-auto rounded-lg border border-slate-800 bg-slate-950/70 p-3 text-sm leading-relaxed text-slate-100 whitespace-pre-wrap">
{{ release.body || 'No changelog text provided.' }}
              </pre>
            </article>
          }
        </div>
      }
    </section>

    <section class="rounded-2xl border border-slate-800 bg-slate-900/40 shadow-xl">
      <div class="flex items-center justify-between border-b border-slate-800 px-5 py-4">
        <div>
          <p class="text-sm font-semibold text-slate-100">Previous updates</p>
          <p class="text-slate-400 text-sm">Full release history from GitHub.</p>
        </div>
      </div>

      @if (!allReleases().length) {
        <div class="px-5 py-6 text-slate-400">
          No releases published yet.
        </div>
      } @else {
        <ul class="divide-y divide-slate-800">
          @for (release of allReleases(); track trackRelease) {
            <li class="px-5 py-4">
              <div class="flex flex-wrap items-start justify-between gap-3">
                <div>
                  <div class="flex items-center gap-2">
                    <span class="text-sm font-semibold text-primary-200">{{ release.tagName }}</span>
                    @if (release.prerelease) {
                      <span class="rounded-full bg-amber-500/20 px-2 py-0.5 text-[11px] font-semibold text-amber-200">Prerelease</span>
                    }
                  </div>
                  <h4 class="text-base font-semibold text-slate-100">
                    {{ release.title || 'Untitled release' }}
                  </h4>
                  <p class="text-xs text-slate-400">
                    Published {{ release.publishedAt | date:'medium' }}
                  </p>
                  <p class="mt-2 max-h-24 overflow-hidden whitespace-pre-line text-sm text-slate-200">
                    {{ release.body || 'No changelog text provided.' }}
                  </p>
                </div>
                <a
                  class="text-sm font-semibold text-sky-300 hover:text-sky-200"
                  [href]="release.htmlUrl"
                  target="_blank"
                  rel="noopener noreferrer">
                  View
                </a>
              </div>
            </li>
          }
        </ul>
      }
    </section>
  }
</div>
